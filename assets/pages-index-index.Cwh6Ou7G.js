import{r as e,s,a,c as t,w as l,i as o,o as i,b as r,d,e as c,F as u,f as n,t as p,g as _,h as m,I as f,n as v,u as h,j as b}from"./index-CHMtd8Q1.js";import{_ as y}from"./uni-icons.CWyZj6tD.js";import{o as k,a as w,b as g,c as j,r as F}from"./uni-app.es.BJJPZxZ3.js";import{_ as x,a as I,U as B}from"./Utils.DOYmfBem.js";import{s as C}from"./store.BSHOeR6v.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=D({__name:"index",setup(D){const M=e(null);e([]);const U=e({where:'is_deleted == false && view_permission == "公开可见"',orderby:"ordinal desc, publish_timestamp desc"}),z=e([{id:1,title:"我的",value:"我的"},{id:2,title:"收藏",value:"收藏"},{id:3,title:"新发",value:"新发"},{id:4,title:"新回",value:"新回"},{id:5,title:"热度",value:"热度"},{id:6,title:"精选",value:"精选"}]),T=e("新发");return k((e=>{})),w((()=>{})),g((()=>{s()})),j((()=>{M.value.loadMore()})),e(""),(e,s)=>{const k=F(a("uni-icons"),y),w=f,g=o,j=b,D=F(a("uni-load-more"),x),$=F(a("unicloud-db"),I);return i(),t(g,{class:"container"},{default:l((()=>[r(g,{class:"search"},{default:l((()=>[r(k,{class:"search-icon",type:"search",size:"45rpx",color:"#BF5AF2"}),r(w,{class:"search-input",onFocus:s[0]||(s[0]=e=>{m({title:"搜索功能未开放",icon:"none",duration:500})}),type:"text",placeholder:"搜索帖子，通过ID搜索请加 '#' "})])),_:1}),r(g,{class:"top-nav-bar"},{default:l((()=>[(i(!0),d(u,null,c(z.value,((e,s)=>(i(),t(g,{class:v(["top-nav-bar-item",{active:e.value===T.value}]),onClick:e=>function(e){if(T.value!==z.value[e].value)switch(T.value=z.value[e].value,T.value){case"我的":U.value={where:`poster_id == "${C.userInfo._id}" && is_deleted == false`,orderby:"ordinal desc, publish_timestamp desc"};break;case"收藏":U.value={where:"1 == 1",orderby:"ordinal desc, publish_timestamp desc"},m({title:"收藏功能未开放",icon:"none",duration:500});break;case"新发":U.value={where:'is_deleted == false && view_permission == "公开可见"',orderby:"ordinal desc, publish_timestamp desc"};break;case"新回":U.value={where:'is_deleted == false && view_permission == "公开可见"',orderby:"replied_timestamp desc"};break;case"热度":U.value={where:"1 == 1",orderby:"ordinal desc, publish_timestamp desc"},m({title:"热度排序未开放",icon:"none",duration:500});break;case"精选":U.value={where:'is_featured == true && is_deleted == false && view_permission == "公开可见"',orderby:"ordinal desc, publish_timestamp desc"}}}(s),key:s},{default:l((()=>[n(p(e.title),1)])),_:2},1032,["onClick","class"])))),128))])),_:1}),r($,{collection:"posts",fields:"_id, content, poster_uname, poster_id, publish_timestamp, likes_count, collections_count, replies_count, is_pinned, is_featured, is_deleted",where:U.value.where,orderby:U.value.orderby,"page-data":"add","page-size":10,loadtime:"auto",ref_key:"postsUDB",ref:M},{default:l((({data:e,loading:s,hasMore:a,error:o,options:m})=>[o?(i(),t(g,{key:0},{default:l((()=>[n(p(o.message),1)])),_:2},1024)):_("",!0),r(g,{class:"posts-container"},{default:l((()=>[(i(!0),d(u,null,c(e,((e,s)=>(i(),t(j,{class:"post-card",key:e._id,"hover-class":"clicked","hover-stay-time":"200",url:`/pages/post-detail/post-detail?post_id=${e._id}`},{default:l((()=>[r(g,{class:"post-card-id-poster"},{default:l((()=>[n(" #"+p(e.ordinal)+" "+p(e.poster_uname),1)])),_:2},1024),r(g,{class:"post-card-date-time"},{default:l((()=>[n(p(h(B).getFormattedTimeBefore(e.publish_timestamp))+" "+p(h(B).getFormattedDateTime(e.publish_timestamp)),1)])),_:2},1024),r(g,{class:"post-card-content"},{default:l((()=>[n(p(h(B).getFormattedContent(e.content)),1)])),_:2},1024),r(g,{class:"post-card-footer"},{default:l((()=>[r(g,{class:"post-card-likes-count"},{default:l((()=>[n(p(e.likes_count)+" 喜欢",1)])),_:2},1024),r(g,{class:"post-card-footer-split"},{default:l((()=>[n("·")])),_:1}),r(g,{class:"post-card-collections-count"},{default:l((()=>[n(p(e.collections_count)+" 收藏",1)])),_:2},1024),r(g,{class:"post-card-replies-count"},{default:l((()=>[n(p(e.replies_count)+" 回复",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128))])),_:2},1024),s?(i(),t(g,{key:1},{default:l((()=>[r(D,{status:"loading"})])),_:1})):a?_("",!0):(i(),t(D,{key:2,status:"noMore"}))])),_:1},8,["where","orderby"])])),_:1})}}},[["__scopeId","data-v-3639664a"]]);export{M as default};
