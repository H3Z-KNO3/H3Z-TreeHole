import{r as t,a as e,c as s,w as a,i as l,o as n,b as o,f as i,t as c,k as u,Y as p,l as d,m as r,h as _,G as f,H as v,p as m,J as b}from"./index-C-XsXVfx.js";import{_ as g}from"./uni-icons.CgipEwkq.js";import{o as h,r as F}from"./uni-app.es.DhiN6RXN.js";import{P as k}from"./Post.Bix-bMvp.js";import{s as y}from"./store.DpSSVhXf.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=x({__name:"publish",setup(x){const B=t(new k);async function C(){(function(){if(!y.userInfo._id)return _({title:"请登录后发布帖子",icon:"none",duration:500}),!1;if(""===B.value.content.trim())return _({title:"内容不能为空",icon:"none",duration:500}),!1;return!0})()&&(u({title:"正在发布",mask:!0}),p.databaseForJQL().collection("posts").orderBy("ordinal desc").field("ordinal").limit(1).get().then((t=>{B.value.ordinal=t.data[0]?t.data[0].ordinal+1:1,B.value._id=void 0,B.value.poster_uname=B.value.is_anonymous?"匿名用户":d("tempUserInfo").uname,p.databaseForJQL().collection("posts").add(B.value).then((t=>{r(),_({title:"发布成功",duration:1e3}),B.value=new k,f({url:"/pages/index/index"})}))})))}return h((()=>{})),(t,u)=>{const p=m,d=F(e("uni-icons"),g),r=l,f=b;return n(),s(r,{class:"container"},{default:a((()=>[o(r,{class:"post-content"},{default:a((()=>[o(p,{class:"post-content-input",modelValue:B.value.content,"onUpdate:modelValue":u[0]||(u[0]=t=>B.value.content=t),maxlength:"10000",placeholder:"输入帖子内容，上限10000字"},null,8,["modelValue"]),o(r,{class:"post-content-buttons-container"},{default:a((()=>[o(r,{class:"post-content-button",onClick:u[1]||(u[1]=t=>{_({title:"表情功能未开放",icon:"none",duration:500})})},{default:a((()=>[o(d,{class:"post-content-button-icon",type:"fire",size:"46rpx",color:"#BF5AF2"}),o(r,{class:"post-content-button-label"},{default:a((()=>[i("表情")])),_:1})])),_:1}),o(r,{class:"post-content-button",onClick:u[2]||(u[2]=t=>{_({title:"图片功能未开放",icon:"none",duration:500})})},{default:a((()=>[o(d,{class:"post-content-button-icon",type:"image",size:"46rpx",color:"#BF5AF2"}),o(r,{class:"post-content-button-label"},{default:a((()=>[i("图片")])),_:1})])),_:1}),o(r,{class:"post-content-button",onClick:u[3]||(u[3]=t=>{_({title:"标签功能未开放",icon:"none",duration:500})})},{default:a((()=>[o(d,{class:"post-content-button-icon",type:"info",size:"46rpx",color:"#BF5AF2"}),o(r,{class:"post-content-button-label"},{default:a((()=>[i("标签")])),_:1})])),_:1}),o(r,{class:"post-content-buttons-space"}),o(r,{class:"post-content-button button-publish",onClick:u[4]||(u[4]=t=>C())},{default:a((()=>[o(r,{class:"post-content-button-label"},{default:a((()=>[i("发布")])),_:1}),o(d,{class:"post-content-button-icon",type:"paperplane",size:"52rpx",color:"#BF5AF2"})])),_:1})])),_:1})])),_:1}),o(r,{class:"post-settings-container"},{default:a((()=>[o(r,{class:"post-setting"},{default:a((()=>[o(r,{class:"post-setting-label"},{default:a((()=>[i("开启匿名")])),_:1}),o(r,{class:"post-setting-value"},{default:a((()=>[o(f,{checked:B.value.is_anonymous,onChange:u[5]||(u[5]=t=>B.value.is_anonymous=t.detail.value),color:"#BF5AF2"},null,8,["checked"])])),_:1})])),_:1}),o(r,{class:"post-setting"},{default:a((()=>[o(r,{class:"post-setting-label"},{default:a((()=>[i("仅自己可评论")])),_:1}),o(r,{class:"post-setting-value"},{default:a((()=>[o(f,{checked:B.value.is_repliable_self,onChange:u[6]||(u[6]=t=>B.value.is_repliable_self=t.detail.value),color:"#BF5AF2"},null,8,["checked"])])),_:1})])),_:1}),o(r,{class:"post-setting"},{default:a((()=>[o(r,{class:"post-setting-label"},{default:a((()=>[i("申请精选")])),_:1}),o(r,{class:"post-setting-value"},{default:a((()=>[o(f,{checked:B.value.is_apply_featured,onChange:u[7]||(u[7]=t=>B.value.is_apply_featured=t.detail.value),color:"#BF5AF2"},null,8,["checked"])])),_:1})])),_:1}),o(r,{class:"post-setting"},{default:a((()=>[o(r,{class:"post-setting-label"},{default:a((()=>[i("申请置顶")])),_:1}),o(r,{class:"post-setting-value"},{default:a((()=>[o(f,{checked:B.value.is_apply_pinned,onChange:u[8]||(u[8]=t=>B.value.is_apply_pinned=t.detail.value),color:"#BF5AF2"},null,8,["checked"])])),_:1})])),_:1}),o(r,{class:"post-setting"},{default:a((()=>[o(r,{class:"post-setting-label"},{default:a((()=>[i("查看权限")])),_:1}),o(r,{class:"post-setting-value",onClick:u[9]||(u[9]=t=>function(){const t=["公开可见","仅自己可见"];v({itemList:t,itemColor:"#BF5AF2",success:e=>{B.value.view_permission=t[e.tapIndex]}})}())},{default:a((()=>[i(c(B.value.view_permission),1)])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-e7377993"]]);export{B as default};
