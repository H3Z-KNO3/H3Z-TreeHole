import{r as t,a as o,c as n,w as e,i as s,o as a,b as l,f as c,k as i,Y as u,l as r,m as p,h as d,G as f,p as _,H as m}from"./index-CHMtd8Q1.js";import{_ as b}from"./uni-icons.CWyZj6tD.js";import{o as v,r as F}from"./uni-app.es.BJJPZxZ3.js";import{P as h}from"./Post.o_hdM71O.js";import{s as g}from"./store.BSHOeR6v.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=x({__name:"publish",setup(x){const y=t(new h);async function k(){(function(){if(!g.userInfo._id)return d({title:"请登录后发布帖子",icon:"none",duration:500}),!1;if(""===y.value.content.trim())return d({title:"内容不能为空",icon:"none",duration:500}),!1;return!0})()&&(i({title:"正在发布",mask:!0}),u.databaseForJQL().collection("posts").orderBy("ordinal desc").field("ordinal").limit(1).get().then((t=>{y.value.ordinal=t.data[0]?t.data[0].ordinal+1:1,y.value._id=void 0,y.value.poster_uname=y.value.is_anonymous?"匿名用户":r("tempUserInfo").uname,u.databaseForJQL().collection("posts").add(y.value).then((t=>{p(),d({title:"发布成功",duration:1e3}),y.value=new h,f({url:"/pages/index/index"})}))})))}return v((()=>{})),(t,i)=>{const u=_,r=F(o("uni-icons"),b),p=s,f=m;return a(),n(p,{class:"container"},{default:e((()=>[l(p,{class:"post-content"},{default:e((()=>[l(u,{class:"post-content-input",modelValue:y.value.content,"onUpdate:modelValue":i[0]||(i[0]=t=>y.value.content=t),maxlength:"10000",placeholder:"输入帖子内容，上限10000字"},null,8,["modelValue"]),l(p,{class:"post-content-buttons-container"},{default:e((()=>[l(p,{class:"post-content-button",onClick:i[1]||(i[1]=t=>{d({title:"表情功能未开放",icon:"none",duration:500})})},{default:e((()=>[l(r,{class:"post-content-button-icon",type:"fire",size:"46rpx",color:"#BF5AF2"}),l(p,{class:"post-content-button-label"},{default:e((()=>[c("表情")])),_:1})])),_:1}),l(p,{class:"post-content-button",onClick:i[2]||(i[2]=t=>{d({title:"图片功能未开放",icon:"none",duration:500})})},{default:e((()=>[l(r,{class:"post-content-button-icon",type:"image",size:"46rpx",color:"#BF5AF2"}),l(p,{class:"post-content-button-label"},{default:e((()=>[c("图片")])),_:1})])),_:1}),l(p,{class:"post-content-button",onClick:i[3]||(i[3]=t=>{d({title:"标签功能未开放",icon:"none",duration:500})})},{default:e((()=>[l(r,{class:"post-content-button-icon",type:"info",size:"46rpx",color:"#BF5AF2"}),l(p,{class:"post-content-button-label"},{default:e((()=>[c("标签")])),_:1})])),_:1}),l(p,{class:"post-content-buttons-space"}),l(p,{class:"post-content-button button-publish",onClick:i[4]||(i[4]=t=>k())},{default:e((()=>[l(p,{class:"post-content-button-label"},{default:e((()=>[c("发布")])),_:1}),l(r,{class:"post-content-button-icon",type:"paperplane",size:"52rpx",color:"#BF5AF2"})])),_:1})])),_:1})])),_:1}),l(p,{class:"post-settings-container"},{default:e((()=>[l(p,{class:"post-setting"},{default:e((()=>[l(p,{class:"post-setting-label"},{default:e((()=>[c("开启匿名")])),_:1}),l(p,{class:"post-setting-value"},{default:e((()=>[l(f,{checked:y.value.is_anonymous,onChange:i[5]||(i[5]=t=>y.value.is_anonymous=t.detail.value),color:"#BF5AF2"},null,8,["checked"])])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-b407ca36"]]);export{y as default};
