import{r as e,s,a,c as t,w as l,i as o,o as i,b as r,d,e as u,F as c,f as n,t as p,g as _,I as m,n as f,u as v,h as b,j as h}from"./index-C-XsXVfx.js";import{_ as y}from"./uni-icons.CgipEwkq.js";import{o as k,a as w,b as g,c as j,r as x}from"./uni-app.es.DhiN6RXN.js";import{_ as F,a as I,U}from"./Utils.DUCaQH3l.js";import{s as B}from"./store.DpSSVhXf.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=C({__name:"index",setup(C){const D=e(null);e([]);const M=e({where:'is_deleted == false && view_permission == "公开可见"',orderby:"ordinal desc, publish_timestamp desc"}),V=e([{id:1,title:"我的",value:"我的"},{id:2,title:"收藏",value:"收藏"},{id:3,title:"新发",value:"新发"},{id:4,title:"新回",value:"新回"},{id:5,title:"热度",value:"热度"},{id:6,title:"精选",value:"精选"}]),z=e("新发");k((e=>{})),w((()=>{})),g((()=>{s()})),j((()=>{D.value.loadMore()}));const T=e("");return(e,s)=>{const k=x(a("uni-icons"),y),w=m,g=o,j=h,C=x(a("uni-load-more"),F),$=x(a("unicloud-db"),I);return i(),t(g,{class:"container"},{default:l((()=>[r(g,{class:"search"},{default:l((()=>[r(k,{class:"search-icon",type:"search",size:"45rpx",color:"#BF5AF2"}),r(w,{class:"search-input",modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=e=>T.value=e),type:"text",placeholder:"搜索帖子，通过ID搜索请加 '#' "},null,8,["modelValue"])])),_:1}),r(g,{class:"top-nav-bar"},{default:l((()=>[(i(!0),d(c,null,u(V.value,((e,s)=>(i(),t(g,{class:f(["top-nav-bar-item",{active:e.value===z.value}]),onClick:e=>function(e){if(z.value!==V.value[e].value)switch(z.value=V.value[e].value,z.value){case"我的":M.value={where:`poster_id == "${B.userInfo._id}" && is_deleted == false`,orderby:"ordinal desc, publish_timestamp desc"};break;case"收藏":M.value={where:"1 == 1",orderby:"ordinal desc, publish_timestamp desc"},b({title:"收藏功能未开放",icon:"none",duration:500});break;case"新发":M.value={where:'is_deleted == false && view_permission == "公开可见"',orderby:"ordinal desc, publish_timestamp desc"};break;case"新回":M.value={where:'is_deleted == false && view_permission == "公开可见"',orderby:"replied_timestamp desc"};break;case"热度":M.value={where:'is_deleted == false && view_permission == "公开可见"',orderby:"replies_count desc, publish_timestamp desc"};break;case"精选":M.value={where:'is_featured == true && is_deleted == false && view_permission == "公开可见"',orderby:"ordinal desc, publish_timestamp desc"}}}(s),key:s},{default:l((()=>[n(p(e.title),1)])),_:2},1032,["onClick","class"])))),128))])),_:1}),r($,{collection:"posts",fields:"_id, content, poster_uname, poster_id, publish_timestamp, likes_count, collections_count, replies_count, is_pinned, is_featured, is_deleted",where:M.value.where,orderby:M.value.orderby,"page-data":"add","page-size":10,loadtime:"auto",ref_key:"postsUDB",ref:D},{default:l((({data:e,loading:s,hasMore:a,error:o,options:m})=>[o?(i(),t(g,{key:0},{default:l((()=>[n(p(o.message),1)])),_:2},1024)):_("",!0),r(g,{class:"posts-container"},{default:l((()=>[(i(!0),d(c,null,u(e,((e,s)=>(i(),t(j,{class:"post-card",key:e._id,"hover-class":"clicked","hover-stay-time":"200",url:`/pages/post-detail/post-detail?post_id=${e._id}`},{default:l((()=>[r(g,{class:"post-card-id-poster"},{default:l((()=>[n(" #"+p(e.ordinal)+" "+p(e.poster_uname),1)])),_:2},1024),r(g,{class:"post-card-date-time"},{default:l((()=>[n(p(v(U).getFormattedTimeBefore(e.publish_timestamp))+" "+p(v(U).getFormattedDateTime(e.publish_timestamp)),1)])),_:2},1024),r(g,{class:"post-card-content"},{default:l((()=>[n(p(v(U).getFormattedContent(e.content)),1)])),_:2},1024),r(g,{class:"post-card-footer"},{default:l((()=>[r(g,{class:"post-card-likes-count"},{default:l((()=>[n(p(e.likes_count)+" 喜欢",1)])),_:2},1024),r(g,{class:"post-card-footer-split"},{default:l((()=>[n("·")])),_:1}),r(g,{class:"post-card-collections-count"},{default:l((()=>[n(p(e.collections_count)+" 收藏",1)])),_:2},1024),r(g,{class:"post-card-replies-count"},{default:l((()=>[n(p(e.replies_count)+" 回复",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128))])),_:2},1024),s?(i(),t(g,{key:1},{default:l((()=>[r(C,{status:"loading"})])),_:1})):a?_("",!0):(i(),t(C,{key:2,status:"noMore"}))])),_:1},8,["where","orderby"])])),_:1})}}},[["__scopeId","data-v-e80c2bef"]]);export{D as default};
